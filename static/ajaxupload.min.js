(function(){var g=document,k=window;function r(a){if(typeof a=="string")a=g.getElementById(a);return a}function j(a,b,c){if(k.addEventListener)a.addEventListener(b,c,false);else if(k.attachEvent){var d=function(){c.call(a,k.event)};a.attachEvent("on"+b,d)}}var m=function(){var a=g.createElement("div");return function(b){a.innerHTML=b;b=a.childNodes[0];a.removeChild(b);return b}}();function s(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function t(a,b){s(a,b)||(a.className+=" "+
b)}function n(a,b){b=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(b," ")}var o=document.documentElement.getBoundingClientRect?function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument;a=c.body;c=c.documentElement;var d=c.clientTop||a.clientTop||0,f=c.clientLeft||a.clientLeft||0,e=1;if(a.getBoundingClientRect){e=a.getBoundingClientRect();e=(e.right-e.left)/a.clientWidth}if(e>1)f=d=0;d=b.top/e+(window.pageYOffset||c&&c.scrollTop/e||a.scrollTop/e)-d;b=b.left/e+(window.pageXOffset||
c&&c.scrollLeft/e||a.scrollLeft/e)-f;return{top:d,left:b}}:function(a){if(k.jQuery)return jQuery(a).offset();var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0}while(a=a.offsetParent);return{left:c,top:b}};function u(a){var b,c,d;c=o(a);b=c.left;d=c.top;c=b+a.offsetWidth;a=d+a.offsetHeight;return{left:b,right:c,top:d,bottom:a}}function v(a){if(!a.pageX&&a.clientX){var b=1,c=document.body;if(c.getBoundingClientRect){b=c.getBoundingClientRect();b=(b.right-b.left)/c.clientWidth}return{x:a.clientX/b+
g.body.scrollLeft+g.documentElement.scrollLeft,y:a.clientY/b+g.body.scrollTop+g.documentElement.scrollTop}}return{x:a.pageX,y:a.pageY}}var w=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();function p(a){return a.replace(/.*(\/|\\)/,"")}function q(a){return/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):""}var x=function(){var a;return function(){if(a)return a;if(typeof XMLHttpRequest!=="undefined")a=new XMLHttpRequest;else for(var b=["Microsoft.XmlHttp","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0",
"MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0"],c=0;c<b.length;c++)try{a=new ActiveXObject(b[c]);break}catch(d){}return a}}();Ajax_upload=AjaxUpload=function(a,b){if(a.jquery)a=a[0];else if(typeof a=="string"&&/^#.*/.test(a))a=a.slice(1);a=r(a);this._input=null;this._button=a;this._justClicked=this._submitting=this._disabled=false;this._parentDialog=g.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){a=jQuery(this._button).parents(".ui-dialog");if(a.length)this._parentDialog=a[0]}this._settings={action:"upload.php",
name:"userfile",data:{},autoSubmit:true,responseType:false,closeConnection:"",hoverClass:"hover",onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(var c in b)this._settings[c]=b[c];this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){this._input.parentNode&&this._input.parentNode.removeChild(this._input);this._input=
null}},_createInput:function(){var a=this,b=g.createElement("input");b.setAttribute("type","file");b.setAttribute("name",this._settings.name);var c={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(var d in c)b.style[d]=c[d];if(b.style.opacity!=="0")b.style.filter="alpha(opacity=0)";this._parentDialog.appendChild(b);j(b,"change",function(){var f=p(this.value);a._settings.onChange.call(a,
f,q(f))!=false&&a._settings.autoSubmit&&a.submit()});j(b,"click",function(){a.justClicked=true;setTimeout(function(){a.justClicked=false},2500)});this._input=b},_rerouteClicks:function(){var a=this,b,c={top:0,left:0},d=false;j(a._button,"mouseover",function(){if(!(!a._input||d)){d=true;b=u(a._button);if(a._parentDialog!=g.body)c=o(a._parentDialog)}});j(document,"mousemove",function(f){var e=a._input;if(e&&d)if(a._disabled){n(a._button,a._settings.hoverClass);e.style.display="none"}else{f=v(f);if(f.x>=
b.left&&f.x<=b.right&&f.y>=b.top&&f.y<=b.bottom){e.style.top=f.y-c.top+"px";e.style.left=f.x-c.left+"px";e.style.display="block";t(a._button,a._settings.hoverClass)}else{d=false;var l=setInterval(function(){if(!a.justClicked){if(!d)e.style.display="none";clearInterval(l)}},25);n(a._button,a._settings.hoverClass)}}})},_createIframe:function(){var a=w(),b=m('<iframe src="javascript:false;" name="'+a+'" />');b.id=a;b.style.display="none";g.body.appendChild(b);return b},submit:function(){var a=this,b=
this._settings;if(this._input.value!==""){var c=p(this._input.value);if(b.onSubmit.call(this,c,q(c))!=false){var d=this._createIframe(),f=this._createForm(d);f.appendChild(this._input);if(b.closeConnection&&/AppleWebKit|MSIE/.test(navigator.userAgent)){var e=x();e.open("GET",b.closeConnection,false);e.send("")}f.submit();g.body.removeChild(f);this._input=f=null;this._createInput();var l=false;j(d,"load",function(){if(d.src=="javascript:'%3Chtml%3E%3C/html%3E';"||d.src=="javascript:'<html></html>';")l&&
setTimeout(function(){g.body.removeChild(d)},0);else{var h=d.contentDocument?d.contentDocument:frames[d.id].document;if(!(h.readyState&&h.readyState!="complete"))if(!(h.body&&h.body.innerHTML=="false")){var i;if(h.XMLDocument)i=h.XMLDocument;else if(h.body){i=h.body.innerHTML;if(b.responseType&&b.responseType.toLowerCase()=="json"){if(h.body.firstChild&&h.body.firstChild.nodeName.toUpperCase()=="PRE")i=h.body.firstChild.firstChild.nodeValue;i=i?window.eval("("+i+")"):{}}}else i=h;b.onComplete.call(a,
c,i);l=true;d.src="javascript:'<html></html>';"}}})}else{g.body.removeChild(this._input);this._input=null;this._createInput()}}},_createForm:function(a){var b=this._settings,c=m('<form method="post" enctype="multipart/form-data"></form>');c.style.display="none";c.action=b.action;c.target=a.name;g.body.appendChild(c);for(var d in b.data){a=g.createElement("input");a.type="hidden";a.name=d;a.value=b.data[d];c.appendChild(a)}return c}}})();
